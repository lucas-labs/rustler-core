# https://taskfile.dev

version: '3'

tasks:
    db:up:
        desc: ğŸ—ƒï¸ run database migrations (up)
        cmds:
            - sea migrate up

    db:down:
        desc: ğŸ—ƒï¸ run database migrations (down)
        cmds:
            - sea migrate down

    run:watch:
        desc: ğŸš€ watch rustler
        cmds:
            - cargo watch -c -x "run --example=rustler"

    build:watch:
        desc: ğŸš€ watch rustler Â«buildÂ»
        cmds:
            - cargo watch -c -x "build"

    build:
        desc: âš¡ build rustler Â«releaseÂ»
        cmds:
            - cargo build --release

    fmt:check:
        desc: ğŸ¨ check format
        cmds:
            - cargo +nightly fmt --all --check

    fmt:
        desc: ğŸ¨ format rustler
        cmds:
            - cargo +nightly fmt --all

    test:
        desc: ğŸ§ª test rustler-core
        cmds:
            - cargo nextest run --all-features --workspace

    lint:check:
        desc: ğŸ§¶ check linting
        cmds:
            - cargo clippy --workspace

    lint:
        desc: ğŸ§¶ lint rustler
        cmds:
            - cargo clippy --fix --workspace --allow-staged

    release:pre:
        desc: ğŸš€ prerelease rustler-core
        deps:
            - fmt:check
            - lint:check

    release:patch:
        desc: ğŸš€ release Â«patchÂ» version of rustler-core
        deps:
            - release:pre
        cmds:
            - cargo release patch --execute
    
    release:minor:
        desc: ğŸš€ release Â«minorÂ» version of rustler-core
        deps:
            - release:pre
        cmds:
            - cargo release minor --execute

    release:major:
        desc: ğŸš€ release Â«majorÂ» version of rustler-core
        deps:
            - release:pre
        cmds:
            - cargo release major --execute


    release:
        desc: ğŸš€ release Â«patchÂ» version of rustler-core
        deps:
            - release:patch
