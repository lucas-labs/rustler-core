# https://taskfile.dev

version: '3'

tasks:
    run:watch:
        desc: ğŸš€ watch rustler
        cmds:
            - cargo watch -c -x "run --example=rustler"

    build:watch:
        desc: ğŸš€ watch rustler Â«buildÂ»
        cmds:
            - cargo watch -c -x "build"

    build:
        desc: âš¡ build rustler Â«releaseÂ»
        cmds:
            - cargo build --release

    fmt:check:
        desc: ğŸ¨ check format
        cmds:
            - cargo +nightly fmt --all --check

    fmt:
        desc: ğŸ¨ format rustler
        cmds:
            - cargo +nightly fmt --all

    test:
        desc: ğŸ§ª test rustler-core
        cmds:
            - cargo nextest run --all-features --workspace

    lint:check:
        desc: ğŸ§¶ check linting
        cmds:
            - cargo clippy --workspace

    lint:
        desc: ğŸ§¶ lint rustler
        cmds:
            - cargo clippy --fix --workspace --allow-staged

    release:pre:
        desc: ğŸš€ prerelease rustler-core
        deps:
            - fmt:check
            - lint:check

    release:patch:
        desc: ğŸš€ release Â«patchÂ» version of rustler-core
        deps:
            - release:pre
        cmds:
            - cargo release patch --execute --no-confirm
    
    release:minor:
        desc: ğŸš€ release Â«minorÂ» version of rustler-core
        deps:
            - release:pre
        cmds:
            - cargo release minor --execute --no-confirm

    release:major:
        desc: ğŸš€ release Â«majorÂ» version of rustler-core
        deps:
            - release:pre
        cmds:
            - cargo release major --execute --no-confirm

    release:
        aliases:
          - "publish"
        desc: ğŸš€ release Â«patchÂ» version of rustler-core
        deps:
            - release:pre
        cmds:
            - cargo release patch --execute

    fmt+lint:
        desc: ğŸ¨ğŸ§¶ format and lint rustler
        cmds:
            - task fmt
            - git add .
            - task lint